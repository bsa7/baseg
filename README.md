[![License: Unlicense](https://img.shields.io/badge/license-Unlicense-blue.svg)](http://unlicense.org/)
![Pylint](https://github.com/bsa7/baseg/actions/workflows/pylint.yml/badge.svg)&nbsp;
![Pytest](https://github.com/bsa7/baseg/actions/workflows/pytest.yml/badge.svg)&nbsp;
![Coverage](https://gist.github.com/bsa7/03a5a726b2a02f55dc676a0e8df174f6/raw/coverage.svg)&nbsp;

# Сегментация клиентов банка

## Работа с кодом. Соглашения по стилям и т.п.
[Здесь](./docs/code-style.md) находится документация по стилю написания кода и т.п.

## Git flow. Соглашения по командной разработке.
[Здесь](./docs/git-flow.md) находится памятка по работе с ветками в Git.

## Запуск проверок
### Запуск тестов:
```bash
./scripts/run_pytest
```
После запуска тестов в папке coverage формируется файл index.html с отчётом по текущему покрытию кода проекта тестами.

### Запуск линтера PyLint
```bash
./scripts/run_pylint
```

## Запуск приложения

### В режиме разработки, на компьютере разработчика
1. В режиме разработки вы можете использовать сервисы, установленные локально или запустить их в докер контейнере.
Для запуска всех сервисов, необходимых приложению, используйте:
```bash
docker-compose up
```

Если вы хотите демонизировать запущенные контейнеры:
```bash
docker-compose up -d
```

Вы можете так же остановить ранее запущенные контейнеры:
```bash
docker-compose stop
```

Все операции выполняются из корневой папки проекта.

## Загрузка данных
Для имеющегося parquet-файла с данными можно запустить загрузку пользователей в mongodb:
```bash
python -m tasks.load_users ../baseg-shared/data/wallet_urfu.parquet.gzip
=> Идёт загрузка записей: 100.0% готово. Всего найдено 1695384 уникальных пользователей.
```

Где `../baseg-shared/data/wallet_urfu.parquet.gzip` - расположение файла с данными (он не входит в репозиторий)
относительно корневой папки проекта.

## Выполнение SQL запросов в Spark
Для имеющегося большого набора данных, например ~10M строк, быстро обработать данные можно с помощью Apache Spark. Инструкция находится [тут](./docs/spark_with_sql.md)

## Другие задачи
В процессе реализации проекта, могут быть реализованы отдельные задачи, оформленные в виде скриптов.
Описание этих задач находится [тут](./docs/tasks.md)
